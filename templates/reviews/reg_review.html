{% extends "index.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/reg_review.css') }}">
{% endblock %}

{%block section%} 
<body> 
  <main>
    <br>
    <form method="POST" action="{{ url_for('reviews.reg_review', productId=productId) }}" enctype="multipart/form-data">
      <div class="form-container">
        <div class="titleReview">
          <p>리뷰 작성</p>
          <p class="discription">제품에 대한 리뷰를 작성해주세요</p>
        </div>
        <hr>
        <br>
        <br>
        <div class="left">
          <div class="form-row">
            <label for="productName">상품명</label>
            <input class="inlg" type="text" id="productName" name="productName" value="{{ productName }}" readonly>
          </div>
      
          <div class="form-row2">
            <label for="title">제목</label>
            <input class="inpn" type="text" id="title" name="title" placeholder="제목을 입력하세요">
          </div>
      
          <div class="form-row3">
            <label for="star">평점</label>
            <fieldset>
              <span class="text-bold">별점을 선택해주세요</span>
              <div class="stars">
                <div class="star" data-value="1"></div>
                <div class="star" data-value="2"></div>
                <div class="star" data-value="3"></div>
                <div class="star" data-value="4"></div>
                <div class="star" data-value="5"></div>
              </div>
            </fieldset>
            <input type="hidden" id="rate" name="rate" value="0">
          </div>
        </div>
        
        <br>
        <div class="form-row4">
          <label for="content">내용</label>
          <textarea class="content-area" id="content" name="content" placeholder="최소 20자 이상 작성해주세요." rows="6"></textarea>
        </div>
    
    
        <div class="form-row6">
          <label class="file-label" for="reviewImage">이미지</label>
          <label class="fileTitle" for="reviewImage">choose file</label>
          <input class="file" type="file" onchange="readURL(this);" id="reviewImage" name="reviewImage" accept="image/*">
          <img id="preview" style="display:none;"/>
          <div id="fileCount" margin-bottom:10px;>0개의 파일이 선택되었습니다</div>
        </div>
        <script>
          function readURL(input) {
            if (input.files && input.files.length > 0) {
              // 마지막 파일로 미리보기 설정
              var lastFile = input.files[input.files.length - 1];
              var reader = new FileReader();
              reader.onload = function (e) {
                var preview = document.getElementById('preview');
                preview.src = e.target.result;
                preview.style.display = 'block'; // 이미지를 블록으로 표시
              };
              reader.readAsDataURL(lastFile);
  
              // 파일 개수 업데이트
              var fileCount = input.files.length;
              document.getElementById('fileCount').textContent = fileCount + "개의 파일이 선택되었습니다.";
            } else {
              // 파일이 선택되지 않은 경우 초기화
              var preview = document.getElementById('preview');
              preview.src = "";
              preview.style.display = 'none'; // 미리보기 숨김
              document.getElementById('fileCount').textContent = "0개의 파일이 선택되었습니다.";
            }
          }
        </script>
        <br>
        <div class="button-group">
          <button type="button" class="cancel-button">취소</button>
          <button type="submit" class="submit-button">등록</button>
        </div>
      </div>
    </form>
  </main>
</body>

<script>
document.querySelectorAll('.star').forEach(($star) => {
  $star.addEventListener('click', ({ target }) => {
    // 모든 .star에서 .active 삭제
    document.querySelectorAll('.star').forEach(($star) => {
      $star.classList.remove('active');
    });

    // 클릭한 .star에 .active 추가
    target.classList.add('active');

    // 선택한 별점의 data-value 값을 숨겨진 input 에 설정 
    const rateValue = target.getAttribute("data-value");
    document.getElementById('rate').value=rateValue;
  });
});
</script>
<script>
  document.querySelector('form').addEventListener('submit', function (event) {
      let isValid = true; // 폼 유효성 플래그
      const messages = []; // 에러 메시지를 담을 배열
  
      // 제목 검증
      const title = document.getElementById('title').value.trim();
      if (!title) {
          isValid = false;
          messages.push('제목을 입력하세요.');
      }
  
      // 평점 검증
      const rate = document.getElementById('rate').value;
      if (rate === "0") {
          isValid = false;
          messages.push('별점을 선택해주세요.');
      }
  
      // 내용 검증 (최소 20자)
      const content = document.getElementById('content').value.trim();
      if (content.length < 20) {
          isValid = false;
          messages.push('내용을 최소 20자 이상 작성해주세요.');
      }
  
      // 이미지 검증 (파일이 1개 이상 선택되어야 함)
      const image = document.getElementById('reviewImage').files.length;
      if (image === 0) {
          isValid = false;
          messages.push('파일을 최소 1개 이상 선택해주세요.');
      }
  
      // 유효하지 않은 경우 메시지 출력 및 폼 제출 방지
      if (!isValid) {
          alert(messages.join('\n'));
          event.preventDefault(); // 폼 제출 방지
      }
  });
  
  // 파일 선택 변경 시 선택 상태 표시
  document.getElementById('reviewImage').addEventListener('change', function () {
      const fileCount = this.files.length;
      const fileCountDisplay = document.getElementById('fileCount');
      if (fileCount > 0) {
          fileCountDisplay.textContent = `${fileCount}개의 파일이 선택되었습니다.`;
          fileCountDisplay.style.color = 'green';
      } else {
          fileCountDisplay.textContent = '0개의 파일이 선택되었습니다.';
          fileCountDisplay.style.color = 'red';
      }
  });
  </script>
  

{% endblock %}